version: 2
jobs:
  build:
    machine: true
    working_directory: ~/go/src/github.com/fnproject/fn
    environment: # apparently expansion doesn't work here yet: https://discuss.circleci.com/t/environment-variable-expansion-in-working-directory/11322
      - GOPATH=/home/circleci/go
      - GOVERSION=1.8.3
      - OS=linux
      - ARCH=amd64
    steps:
      - checkout
      # update docker
      - run: |
          go version
          go env GOROOT
          wget https://storage.googleapis.com/golang/$GOVERSION.$OS-$ARCH.tar.gz
          # mkdir -p $HOME/golang
          # tar -C $HOME/golang -xzf go1.8.3.linux-amd64.tar.gz
          tar -C /usr/local -xzf go$GOVERSION.$OS-$ARCH.tar.gz
          go version
          # go get -u github.com/golang/dep/...
      - run: docker version
      # - run: sudo service docker stop
      # - run: curl -fsSL https://get.docker.com/ | sudo sh
      # - run: docker version
      - run: env
      - run: pwd
      - run: ls -al
      - run: make build
      # - run: ./test.sh


#  docker:
#       # specify the version
#       - image: circleci/golang:1.8
      
#       # Specify service dependencies here if necessary
#       # CircleCI maintains a library of pre-built images
#       # documented at https://circleci.com/docs/2.0/circleci-images/
#       # - image: circleci/postgres:9.4

#     #### TEMPLATE_NOTE: go expects specific checkout path representing url
#     #### expecting it in the form of
#     ####   /go/src/github.com/circleci/go-tool
#     ####   /go/src/bitbucket.org/circleci/go-tool
#     working_directory: /go/src/github.com/{{ORG_NAME}}/{{REPO_NAME}}
#     steps:
#       - checkout

#       # specify any bash command here prefixed with `run: `
#       # - run: go get -v -t -d ./...
#       - run: ./test.sh
